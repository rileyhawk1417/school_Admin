const fields=["id","fname","lname","amount_paid","amount_owing","date_joined","is_owing"],dpTable=document.querySelector("#tableBody"),search_name=document.querySelector("#search_btn_name"),search_amount=document.querySelector("#search_btn_amount"),searchOptions=document.querySelector("#searchItems"),money_search_btn=document.querySelector("#money-search"),name_search_btn=document.querySelector("#name-search"),nameSearchContainer=document.querySelector("#search_name"),moneySearchContainer=document.querySelector("#search_amount"),addStudent=document.querySelector("#add-record"),submit=document.querySelector("#send"),form=document.querySelector("#entryForm"),close=document.querySelector("#close_Form"),closeMoneySearch=document.querySelector("#close_money_search"),closeNameSearch=document.querySelector("#close_name_search"),cancel_btn=document.querySelectorAll("#cancel"),print=document.querySelector("#printTable"),innerWidth=window.innerWidth,innerHeight=window.innerHeight,vars={nameSearch:document.querySelector("#searchName"),moneySearch:document.querySelector("#searchAmount"),fname:document.querySelector("#fname"),lname:document.querySelector("#lname"),amount_paid:document.querySelector("#amount_paid"),amount_owing:document.querySelector("#amount_owing"),date_joined:document.querySelector("#DOB"),is_owing:document.querySelector("#dropDown")};var toggleBool=!(window.onload=()=>{loadTable(),searchOptions.style.display="none"});function hideElements(){searchOptions.style.display="none",form.style.display="none"}function closeSearch(e){"close_money_search"===e.target.id||"close_name_search"===e.target.id?hideElements():console.log("Undefined")}function showSearch(e){searchOptions.style.display="flex","name-search"===e.target.id?(searchOptions.style.display="flex",form.style.display="none",nameSearchContainer.style.visibility="visible",moneySearchContainer.style.visibility="hidden"):"money-search"===e.target.id?(searchOptions.style.display="flex",form.style.display="none",nameSearchContainer.style.visibility="hidden",moneySearchContainer.style.visibility="visible"):console.log("Undefined")}function showForm(){form.style.display="flex"}function hideForm(){form.style.display="none"}async function loadTable(){hideElements();try{for(;dpTable.firstChild;)dpTable.removeChild(dpTable.firstChild);const e=await fetch("http://localhost:5000/users/student_data",{method:"GET"}),t=await e.json();t.forEach(n=>{const a=dpTable.insertRow();fields.forEach(e=>{const t=a.insertCell();t.innerText=n[e],t.classList.add("trContent")});const e=a.insertCell(),t=document.createElement("button"),o=document.createElement("i");o.classList.add("fas","fa-trash","trash-btn"),t.append(o),e.append(t),t.addEventListener("click",async e=>{if(window.confirm("Delete")){console.log("trash icon clicked");const t={};t.id=n.id;await fetch("http://localhost:5000/users/student_data",{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify(t)});alert("Deleted Record"),loadTable()}})})}catch(e){console.log(`Cant load List ${e}`)}}async function addRecord(e,t,n,a,o,c){try{const r={};r.fname=e,r.lname=t,r.amount_paid=n,r.amount_owing=a,r.date_joined=o,r.is_owing=c;const i=await fetch("http://localhost:5000/users/student_data",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r)});var s=await i.json();console.log(s),loadTable()}catch(o){console.log(`Error caused by: ${o}`)}}async function nameSearch(t){try{for(;dpTable.firstChild;)dpTable.removeChild(dpTable.firstChild);const n=await fetch("http://localhost:5000/users/student_data",{method:"GET"}),a=await n.json();let e=a.filter(e=>t===e.fname?e.fname===t:t!==e.lname?e.lname===t:void 0);e.forEach(n=>{const a=dpTable.insertRow();fields.forEach(e=>{const t=a.insertCell();t.innerText=n[e],t.className="trContent"});const e=a.insertCell(),t=document.createElement("button"),o=document.createElement("i");o.classList.add("fas","fa-trash","trash-btn"),t.append(o),e.append(t),t.addEventListener("click",async e=>{if(window.confirm("Delete")){console.log("trash icon clicked");const t={};t.id=n.id;await fetch("http://localhost:5000/users/student_data",{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify(t)});alert("Deleted Record"),loadTable()}})}),console.log(e)}catch(e){console.log(`Cause of error ${e}`)}}async function moneySearch(t){try{for(;dpTable.firstChild;)dpTable.removeChild(dpTable.firstChild);const n=await fetch("http://localhost:5000/users/student_data",{method:"GET"}),a=await n.json();let e=a.filter(e=>e.amount_owing>t||e.owing<t?e.amount_owing:alert("failed to find result"));e.forEach(n=>{const a=dpTable.insertRow();fields.forEach(e=>{const t=a.insertCell();t.innerText=n[e],t.className="trContent"});const e=a.insertCell(),t=document.createElement("button"),o=document.createElement("i");o.classList.add("fas","fa-trash","trash-btn"),t.append(o),e.append(t),t.addEventListener("click",async e=>{if(window.confirm("Delete")){console.log("trash icon clicked");const t={};t.id=n.id;await fetch("http://localhost:5000/users/student_data",{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify(t)});alert("Deleted Record"),loadTable()}})})}catch(e){console.log(`Encountered error: ${e}`)}}search_name.addEventListener("click",()=>{nameSearch(vars.nameSearch.value)}),search_amount.addEventListener("click",()=>{moneySearch(vars.moneySearch.value)}),money_search_btn.addEventListener("click",e=>{showSearch(e)}),name_search_btn.addEventListener("click",e=>{showSearch(e)}),addStudent.addEventListener("click",()=>{showForm(),searchOptions.style.display="none",nameSearchContainer.style.visibility="hidden",moneySearchContainer.style.visibility="hidden"}),send.addEventListener("click",()=>{addRecord(vars.fname.value,vars.lname.value,vars.amount_paid.value,vars.amount_owing.value,vars.date_joined.value,vars.is_owing.value)}),close.addEventListener("click",()=>{hideForm()}),closeMoneySearch.addEventListener("click",e=>{closeSearch(e)}),closeNameSearch.addEventListener("click",e=>{closeSearch(e)}),print.addEventListener("click",()=>{hideElements(),window.print()}),window.addEventListener("resize",()=>{dpTable.style.width=innerWidth});